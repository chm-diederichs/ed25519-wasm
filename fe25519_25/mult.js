
module.exports = loadWebAssembly

loadWebAssembly.supported = typeof WebAssembly !== 'undefined'

function loadWebAssembly (opts) {
  if (!loadWebAssembly.supported) return null

  var imp = opts && opts.imports
  var wasm = toUint8Array('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')
  var ready = null

  var mod = {
    buffer: wasm,
    memory: null,
    exports: null,
    realloc: realloc,
    onload: onload
  }

  onload(function () {})

  return mod

  function realloc (size) {
    mod.exports.memory.grow(Math.max(0, Math.ceil(Math.abs(size - mod.memory.length) / 65536)))
    mod.memory = new Uint8Array(mod.exports.memory.buffer)
  }

  function onload (cb) {
    if (mod.exports) return cb()

    if (ready) {
      ready.then(cb.bind(null, null)).catch(cb)
      return
    }

    try {
      if (opts && opts.async) throw new Error('async')
      setup({instance: new WebAssembly.Instance(new WebAssembly.Module(wasm), imp)})
    } catch (err) {
      ready = WebAssembly.instantiate(wasm, imp).then(setup)
    }

    onload(cb)
  }

  function setup (w) {
    mod.exports = w.instance.exports
    mod.memory = mod.exports.memory && mod.exports.memory.buffer && new Uint8Array(mod.exports.memory.buffer)
  }
}

function toUint8Array (s) {
  if (typeof atob === 'function') return new Uint8Array(atob(s).split('').map(charCodeAt))
  return (require('buf' + 'fer').Buffer).from(s, 'base64')
}

function charCodeAt (c) {
  return c.charCodeAt(0)
}
